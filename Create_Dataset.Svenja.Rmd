---
title: "Datensatz komplett"
output: html_notebook
---

```{r}

###load libraries###

library(readr)
library(ggplot2)
library(dplyr)
library(lubridate)
library(tidyr)
library(readxl)
library(magrittr)


###load datasets###

umsatz <- read_csv("Daten/umsatzdaten_gekuerzt.csv", 
    col_types = cols(Datum = col_date(format = "%Y-%m-%d")))
umsatz <- umsatz %>% mutate(Datum = as.Date(umsatz$Datum))


kiwo <- read_csv("Daten/kiwo.csv", col_types = cols(Datum = col_date(format = "%Y-%m-%d")))
kiwo <- kiwo %>% mutate(Datum = as.Date(kiwo$Datum))

wetter <- read_csv("Daten/wetter.csv")
wetter <- wetter %>% mutate(Datum = as.Date(wetter$Datum))

wetter %<>% 
  mutate(WindFct = cut(Windgeschwindigkeit, 
                       breaks = c(0, 5, 10, 20, 28, max(Windgeschwindigkeit)), 
                       labels = c("leicht bis schwach", "mäßig bis frisch", "stark bis stürmisch", "Sturm", "Orkan"), 
                       include.lowest = T, right = F))

wetter %<>% 
  mutate(BewoelkungFct = cut(Bewoelkung, 
                       breaks = c(0, 1, 3, 7, 8), 
                       labels = c("nicht bewoelkt", "heiter", "stark bewoelkt", "bedeckt"), 
                       include.lowest = T, right=F))

wetter %<>% 
  mutate(TemperaturFct = cut(Temperatur, 
                       breaks = c(-10, 1, 15, 24, 30, 40), 
                       labels = c("Eistag", "Kalttag", "Warmtag", "Sommertag", "Hitzetag"), 
                       include.lowest = T, right=F))

wetter %<>% 
  mutate(WettercodeFct = cut(Wettercode, 
                       breaks = c(0, 49, 59, 69, 79, 90, 99), 
                       labels = c("Keine Form von Niederschlag", "Sprühregen", "Regen", "Schnee", "Schauer", "Gewitter"), 
                       include.lowest = T, right=F))


arbeitslosigkeit <- read_delim("Daten/Arbeitslosigkeit.csv", 
    ";", escape_double = FALSE, col_types = cols(Datum = col_date(format = "%d.%m.%Y")), 
    trim_ws = TRUE) 
arbeitslosigkeit <- arbeitslosigkeit %>% mutate(Datum = as.Date(arbeitslosigkeit$Datum))


semesterferien <- read_excel("Daten/CAU_Semesterferien.xlsx", 
    col_types = c("date", "numeric"))
semesterferien <- semesterferien %>% mutate(Datum = as.Date(semesterferien$Datum))


datumsangaben <- read_delim("Daten/Date.csv", ";", escape_double = FALSE, 
    col_types = cols(Datum = col_date(format = "%d.%m.%Y")), 
    trim_ws = TRUE)
datumsangaben <- datumsangaben %>% mutate(Datum = as.Date(datumsangaben$Datum))


digitale_woche <- read_excel("Daten/Digitale_Woche.xlsx", 
    col_types = c("date", "numeric"))
digitale_woche <- digitale_woche %>% mutate(Datum = as.Date(digitale_woche$Datum))


feiertage <- read_delim("Daten/Feiertage.csv", 
    ";", escape_double = FALSE, col_types = cols(Datum = col_date(format = "%d.%m.%Y")))
feiertage <- feiertage[,-c(7:13)] 
feiertage <- feiertage %>% mutate(Datum = as.Date(feiertage$Datum))


jahreszeitenbeginn <- read_excel("Daten/Jahreszeitenbeginn.xlsx", 
    col_types = c("date", "numeric", "text"))
jahreszeitenbeginn <- jahreszeitenbeginn %>% mutate(Datum = as.Date(jahreszeitenbeginn$Datum))


jahreszeiten <- read_excel("Daten/Meteorologische Jahreszeiten.xlsx", 
    col_types = c("date", "numeric", "numeric", 
        "numeric", "numeric"))
jahreszeiten <- jahreszeiten %>% mutate(Datum = as.Date(jahreszeiten$Datum))


bevoelkerung <- read_excel("Daten/Population_Kiel.xlsx", 
    col_types = c("date", "numeric"))
bevoelkerung <- bevoelkerung %>% mutate(Datum = as.Date(bevoelkerung$Datum))

schulferien <- read_excel("Daten/Schulferien.xlsx", 
    col_types = c("date", "numeric"))
schulferien <- schulferien %>% mutate(Datum = as.Date(schulferien$Datum))


temperaturdifferenz <- read_excel("Daten/Temperaturdifferenz_und_Durchschnitt.xlsx", 
    col_types = c("date", "numeric", "numeric", 
        "numeric", "numeric", "numeric"))
temperaturdifferenz <- temperaturdifferenz %>% mutate(Datum = as.Date(temperaturdifferenz$Datum))


tourismus <- read_excel("Daten/Tourismus.xlsx", 
    col_types = c("date", "numeric", "numeric", 
        "numeric", "numeric", "text"))
tourismus <- tourismus[,-6]
tourismus <- tourismus %>% mutate(Datum = as.Date(tourismus$Datum))


wahlen <- read_excel("Daten/Wahlen.xlsx", col_types = c("date", 
    "numeric", "text"))
wahlen <- wahlen %>% mutate(Datum = as.Date(wahlen$Datum))


weihnachtsmarkt <- read_excel("Daten/Weihnachtsmarkt.xlsx", 
    col_types = c("date", "numeric"))
weihnachtsmarkt <- weihnachtsmarkt %>% mutate(Datum = as.Date(weihnachtsmarkt$Datum))


zeitumstellung <- read_excel("Daten/Zeitumstellung.xlsx", 
    col_types = c("date", "numeric", "text"))
zeitumstellung <- zeitumstellung %>% mutate(Datum = as.Date(zeitumstellung$Datum))


###join datasets by Datum ###
total <- left_join(umsatz, kiwo, by = "Datum")
total <- left_join(total,wetter, by = "Datum")
total <- left_join(total,arbeitslosigkeit, by = "Datum")
total <- left_join(total,semesterferien,  by = "Datum")
total <- left_join(total,datumsangaben,  by = "Datum")
total <- left_join(total,digitale_woche,  by = "Datum")
total <- left_join(total,feiertage, by = "Datum")
total <- left_join(total, jahreszeitenbeginn, by = "Datum")
total <- left_join(total, jahreszeiten, by = "Datum")
total <- left_join(total, bevoelkerung, by = "Datum")
total <- left_join(total, schulferien, by = "Datum")
total <- left_join(total, temperaturdifferenz, by = "Datum")
total <- left_join(total, tourismus, by = "Datum")
total <- left_join(total, wahlen, by = "Datum")
total <- left_join(total, weihnachtsmarkt, by = "Datum")
total <- left_join(total, zeitumstellung, by = "Datum")





### Adjust the joined Dataset ###

names(total)
names(total)[names(total) == 'Brueckentag '] <- 'Brueckentag'
names(total)[names(total) == 'Langes_Wochenende '] <- 'Langes_Wochenende'
names(total)[names(total) == 'Differenz_zum Mittel'] <- 'Differenz_zum_Mittel'
names(total)[names(total) == 'Kommentar.y'] <- 'Zeit'

# Replace some na values with 0 
total$Kieler_Woche[is.na(total$Kieler_Woche)] = 0 
total$Semesterferien[is.na(total$Semesterferien)] = 0
total$Digitale_Woche[is.na(total$Digitale_Woche)] = 0
total$Neue_Jahreszeit[is.na(total$Neue_Jahreszeit)] = 0
total$Winter[is.na(total$Winter)] = 0
total$Fruehling[is.na(total$Fruehling)] = 0
total$Sommer[is.na(total$Sommer)] = 0
total$Herbst[is.na(total$Herbst)] = 0
total$Schulferien[is.na(total$Schulferien)] = 0
total$Ankuenfte[is.na(total$Ankuenfte)] = 0
total$Uebernachtungen[is.na(total$Uebernachtungen)] = 0
total$Wahl[is.na(total$Wahl)] = 0
total$Weihnachtsmarkt[is.na(total$Weihnachtsmarkt)] = 0
total$Feiertagsart[is.na(total$Feiertagsart)] = 0
total$Gesetzl_Feiertag[is.na(total$Gesetzl_Feiertag)] = 0
total$Brueckentag[is.na(total$Brueckentag)] = 0
total$Langes_Wochenende[is.na(total$Langes_Wochenende)] = 0


###delete columns###
total <- total[,-c( 25, 27, 40, 42, 44)]

View(total)


#write_csv(total,"Dataset_total.csv")
```


